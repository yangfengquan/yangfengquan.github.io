<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工程在线计算软件</title>
    <link rel="stylesheet" href="style.css">
    <script src="JS/form.js"></script>
    <script src="JS/xsteam.js"></script>
    <script src="JS/pipe.js"></script>
    <script src="JS/equipment.js"></script>
    <script src="JS/props.js"></script>
</head>
<body>
    <div class="wrap">
        <div id="sidebar">
            <h1><a href="./">TangYuan</a></h1>
            <img src="./img/nav.png" width="30" height="30" onclick="ontoggledisplay()" id="navimg">
            <div id="nav">
                <h2>目录</h2>
                <ul id="list"></ul>
                <h2>手机扫码访问</h2>
                <img src="img/addr.png" alt="手机扫码访问" width="125" height="125">
                <h2>微信公众号</h2>
                <img src="img/gzh.bmp" alt="微信公众号" width="120" height="120">
                <p>网站作者：杨奉全</p>
                <p>邮箱： <a href="mailto:yangfengquan@126.com">yangfengquan@126.com</a></p>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                <p style="font-size: 14px; color: #ccc;"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></p>
            </div>
            
        </div>
        <div id="tab">
            <h2>功能列表</h2>
			<div class="list-item">
				<h4><a href="#pipeDiameter">管径在线计算</a></h4>
				<p>已知管道的体积流量和流速，计算管道内径。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#pipeVelocity">管道流速在线计算</a></h4>
				<p>已知管道的体积流量和管道内径，计算物料流速。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#pipeWeight">管子重量在线计算</a></h4>
				<p>已知管道的外径、壁厚和管材密度，计算管道重量。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#pipeSize">钢管尺寸在线查询</a></h4>
				<p>查询壁厚系列、管道外径、壁厚和单重，数据来自标准SH/T3405-2017。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#pipeStrength">管道壁厚在线计算</a></h4>
				<p>在设计压力、温度条件下，计算管子的壁厚，计算依据标准：GB/T 20801.3-2020。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#pipeHInsultion">管道保温在线计算</a></h4>
				<p>计算管道的热损失、保温外表面温度，绝热材料的传热系数，计算依据标准：GB 50264。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#pipeCInsultion">管道保冷在线计算</a></h4>
				<p>计算管道的冷损失、保冷外表面温度，保冷材料的传热系数，计算依据标准：GB 50264。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#waterpipe">水和水蒸汽管道阻力、温降在线计算</a></h4>
				<p>同时计算水和水蒸气管道的阻力、温降，不适用汽水混合、压降超过40%水和水蒸气管道计算，计算依据标准：GB 50264、DL/T5054等。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#pumpPower">泵轴功率在线计算</a></h4>
				<p>计算泵的轴功率，为原动机选型和生产能耗提供依据。</p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="#waterprops">水和蒸汽物性在线计算</a></h4>
				<p>计算水、蒸汽的密度、焓值、内能、比热容、声速、导热系数等热力学性质，计算依据：国际水和水蒸气性质学会于1997年通过的工业用水和水蒸气热力学性质IF97公式<a href="http://www.iapws.org/relguide/IF97-Rev.pdf">http://www.iapws.org/relguide/IF97-Rev.pdf</a></p>
				<small>2023-6-20</small>
			</div>
			<div class="list-item">
				<h4><a href="props.html">纯物质物性在线计算</a></h4>
				<p>计算纯物质的焓值、饱和状态、粘度、比热容等多种性质。氦、氢、氯化氢、硫化氢、异丁烷、异丁烯、异己烷、异戊烷、氪、甲烷、甲醇、亚油酸甲酯、亚油酸甲酯、油酸甲酯、棕榈酸甲酯、硬脂酸甲酯、氖、、氮、一氧化二氮、正氘、正氢、氧、丙烯、丙炔、二氧化硫、六氟化硫、甲苯、水、氙、顺-2-丁烯、间二甲苯、正丁烷、正癸烷、正十二烷、正庚烷、正己烷、正壬烷、正辛烷、正戊烷、正丙烷、正十一烷、邻二甲苯、对二甲苯、反-2-丁烯、1-丁烯、丙酮、空气、氨、氩、苯、二氧化碳、一氧化碳、羰基硫、环己烷、环丙烷、环戊烷、氘、二乙醚、碳酸二甲酯、二甲醚、乙烷、二氯乙烷、乙醇、乙苯、乙烯、环氧乙烷、氟、R11、R113、R114、R115、R116、R12、R123、R1233zd(E)、R1234yf、R1234ze(E)、R1234ze(Z)、R124、R1243zf、R125、R13、R134a、R13I1、R14、R141b、R142b、R143a、R152A、R161、R21、R218、R22、R227EA、R23、R236EA、R236FA、R245ca、R245fa、R32、R365MFC、R40、R404A、R407C、R41、R410A、R507A、RC318、SES36等122种物质数据库。</p>
				<small>2023-6-23</small>
			</div>
        </div>
    </div>
    <script>
        var response = {}
        var fm = ''
        var curFormDataObj = {}
        const dataPath = 'data.json';

        (function () {
            const urlSearchParams = new URLSearchParams(window.location.search)
            fm = urlSearchParams.get('fm')
            const xhr = new XMLHttpRequest()
            xhr.open('GET', dataPath, true)
            xhr.send()
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    response = JSON.parse(xhr.responseText)
                    createNavlist(response)
                    createMainEle()
                }
            }
        })()

        function createNavlist(data){
            let navEle = document.getElementById('list')
            Object.keys(response).forEach( key => {
                let liEle = document.createElement('li')
                let aEle = document.createElement('a')
                aEle.href = "?fm=" + key
                aEle.innerText = response[key].text
                liEle.appendChild(aEle)
                navEle.appendChild(liEle)
            })
            let liEle1 = document.createElement('li')
            let aEle1 = document.createElement('a')
            aEle1.href = "./props.html"
            aEle1.innerText = '纯物质物性计算'
            liEle1.appendChild(aEle1)
            navEle.appendChild(liEle1)
        }

        function ontoggledisplay() {
            if (document.getElementById('nav').style.display == 'block') {
                document.getElementById('nav').style.display = 'none'
            } else {
                document.getElementById('nav').style.display = 'block'
            }
        }

        //window.onhashchange = createMainEle

        function createMainEle() {            
            if (fm == '') {
                return
            }
            curFormDataObj = response[fm]

            let tabEle = document.getElementById('tab')
            tabEle.innerHTML = ''
            //document.getElementById('form-title').innerText = curFormDataObj.text
            let titleEle = document.createElement('h2')
            titleEle.innerText = curFormDataObj.text
            tabEle.appendChild(titleEle)

            let formEle = document.createElement('form')
            form(curFormDataObj.form, formEle)
            let warningEle = document.createElement('p')
            warningEle.id = 'warning'
            warningEle.style.color = '#ff0000'
            formEle.appendChild(warningEle)
            tabEle.appendChild(formEle)

            //添加<br>，表单项连续为inline，实现换行
            if (fm == 'waterprops') {
                let brEle = document.createElement('br')
                formEle.insertBefore(brEle, formEle.childNodes[3])
            }

            let calcBtn = document.createElement('button')
            calcBtn.innerText = '运算'
            calcBtn.addEventListener('click', calc)
            tabEle.appendChild(calcBtn)

            let pdfBtn = document.createElement('button')
            pdfBtn.innerText = '计算书'
            pdfBtn.addEventListener('click', pdf)
            tabEle.appendChild(pdfBtn)

            let resTitleEle = document.createElement('h2')
            resTitleEle.innerText = '结果'
            tabEle.appendChild(resTitleEle)

            let resultEle = document.createElement('form')
            form(curFormDataObj.result, resultEle)
            tabEle.appendChild(resultEle)

            //手机端生成表单后，隐藏导航列表
            if (window.screen.width <= 600) {
                document.getElementById('nav').style.display = 'none'
            }
        }

        function calc() {
            if (getFormValue()) {
                let r = eval(fm)(curFormDataObj.form)
                r.forEach((v, i) => {
                    curFormDataObj.result[i].value = v
                });
                curFormDataObj.result.forEach(item => {
                document.getElementById(item.id).value = item.value
                });
                return true
            }
            return false  
        }
        function pdf() {
            if (calc()) {
                window.data1 = [], window.data2 = []
                if (fm == 'pipeHInsultion' || fm == 'pipeCInsultion' || fm == 'waterpipe') {
                    let name = '', value = ''
                    curFormDataObj.form.forEach(item => {
                        if (item.id == 'a' || item.id == 'b' || item.id == 'c' || item.id == 'd' || item.id == 'e' || item.id == 'f') {
                            name += item.name
                            value += item.value + item.other
                        } else if (item.id == 'g') {
                            value += item.value + item.other
                            window.data1.push({name: name, value: value, other: ''})
                        } else {
                            window.data1.push({name: item.name, value: item.value, other: item.other})
                        }
                    });
                } else {
                    curFormDataObj.form.forEach(item => {
                        if (item.tag == 'select') {
                            let text = ''
                            item.opts.forEach(opt => {
                                if (opt.value == item.value) {
                                    text = opt.text
                                }
                            })
                            window.data1.push({name: item.name, value: text, other: item.other})
                        } else {
                            window.data1.push({name: item.name, value: item.value, other: item.other})
                        }
                        
                    });
                }

                if (fm == 'waterprops') {
                    window.data1[1].name = window.data1[1].value
                    window.data1[1].value = window.data1[2].value
                    window.data1[1].other = window.data1[2].other
                    window.data1[3].name = window.data1[3].value
                    window.data1[3].value = window.data1[4].value
                    window.data1[3].other = window.data1[4].other
                    window.data1.splice(2,1)
                    window.data1.splice(3,1)
                }

                curFormDataObj.result.forEach(item => {
                    window.data2.push({name: item.name, value: item.value, other: item.other})
                });

                window.open('pdf.html')
            }
            
        }
    </script>
    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?f21a3bcbd68f3fda366faacbd5cb7c4d";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>
</html>